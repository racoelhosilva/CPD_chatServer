# Protocol Specification

## Overview

The following protocol specification details the structure used for this project for communication. The project involves room-based message exchange between multiple clients and a centralized server while ensuring causality. The connections between clients and server are established using Secure Sockets.

Based on this, we developed a simple protocol that defines how commands should be created, serialized, sent, received and parsed on both ends, triggering the correct actions. Below is an overview of the different units of this protocol with arguments and meaning for each of them.

## Unit Format

```text
<command> [arg1 [arg2 ...]]
```

### Protocol Units

| Command       | Direction | Arguments                 | Purpose                                                    |
| ------------- | :-------: | ------------------------- | ---------------------------------------------------------- |
| `enter`       |   C → S   | `room`                    | Join (or create, if it doesn't exist) a chat room          |
| `eof`         |   C ↔ S   |                           | End of connection from the other side of the socket        |
| `err`         |   C ← S   | `errorCode`               | Error response using `ProtocolErrorIdentifier` enumeration |
| `invalid`     |   C → S   |                           | Invalid Token generated by a user malformed command        |
| `leave`       |   C → S   |                           | Exit current room (if user is in a room)                   |
| `list-rooms`  |   C → S   |                           | Query server for existing rooms (AI and normal)            |
| `login`       |   C → S   | `username` `password`     | Login into existing account (with credentials)             |
| `login-token` |   C → S   | `token`                   | Re-authenticate using previous session token               |
| `logout`      |   C → S   |                           | Logout of the current account (if user is logged in)       |
| `ok`          |   C ← S   | `data`                    | Generic success (e.g. session token, enter room)           |
| `ping`        |   C ↔ S   |                           | Keep-alive exchange between client and server              |
| `pong`        |   C ↔ S   |                           | Response to `ping`                                         |
| `recv`        |   C ← S   | `id` `username` `message` | Received message from server with id, username and message |
| `register`    |   C → S   | `username` `password`     | Register a new user into the platform                      |
| `send`        |   C → S   | `message`                 | Send message to current room                               |
| `sync`        |   C → S   | `lastId`                  | Synchronization requests between user and server           |

### Legend

| Direction |       Flow       |
| :-------: | :--------------: |
| **C → S** | Client to Server |
| **C ← S** | Server to Client |
| **C ↔ S** |  Bidirectional   |
